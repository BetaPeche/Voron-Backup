[include mmu/base/*.cfg]
[include mmu/optional/client_macros.cfg]
[include mmu/optional/mmu_menu.cfg]
# [include mmu/addons/mmu_erec_cutter.cfg]
[include mainsail.cfg]
[include led_stealthburner.cfg]
[include nozzle_clean.cfg]
[include filament.cfg]

# This file contains common pin mappings for the BigTreeTech Octopus V1.
# To use this config, the firmware should be compiled for the STM32F446 with a "32KiB bootloader"
# Enable "extra low-level configuration options" and select the "12MHz crystal" as clock reference

# after running "make", copy the generated "klipper/out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the OctoPus with that SD card.

# See docs/Config_Reference.md for a description of parameters.

## Voron Design VORON2 250/300/350mm BigTreeTech OctoPus V1 TMC2209 UART config

## *** THINGS TO CHANGE/CHECK: ***
## MCU paths                            [mcu] section
## Thermistor types                     [extruder] and [heater_bed] sections - See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types
## Hotend heater pin                    [extruder] section
## Z Endstop Switch location            [safe_z_home] section
## Homing end position                  [gcode_macro G32] section
## Z Endstop Switch  offset for Z0      [stepper_z] section
## Stepper Z1 enable pin                [stepper_z1] section
## Probe points                         [quad_gantry_level] section
## Min & Max gantry corner postions     [quad_gantry_level] section
## PID tune                             [extruder] and [heater_bed] sections
## Probe pin                            [probe] section
## Fine tune E steps                    [extruder] section

[mcu]
##  Obtain definition by "ls /dev/serial/by-id/*" then unplug to verify
##--------------------------------------------------------------------
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_4A004C000C51303432383339-if00
restart_method: command
##--------------------------------------------------------------------

[exclude_object]

[gcode_arcs]

[input_shaper]
shaper_freq_x: 86.8 # center frequency for the X axis filter
shaper_type_x: 2hump_ei # filter type for the X axis
shaper_freq_y: 47 # center frequency for the Y axis filter
shaper_type_y: ei # filter type for the Y axis
damping_ratio_x: 0.063 # damping ratio for the X axis
damping_ratio_y: 0.096 # damping ratio for the Y axis

[temperature_sensor chamber]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PF7

[output_pin filter]
pin: PD14
#pwm: False  # Change à True si c'est un contrôle PWM (par exemple, pour la vitesse d'un ventilateur)
value: 0 

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 3000             #Max 4000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to MOTOR_0
##  Endstop connected to DIAG_0
[stepper_x]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: PG6
position_min: 0
##--------------------------------------------------------------------

##  Uncomment below for 250mm build
#position_endstop: 250
#position_max: 250

##  Uncomment for 300mm build
#position_endstop: 300
#position_max: 300

##  Uncomment for 350mm build
position_endstop: 350
position_max: 350

##--------------------------------------------------------------------
homing_speed: 25   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_x]
uart_pin: PD3
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  A Stepper - Right
##  Connected to MOTOR_1
##  Endstop connected to DIAG_1
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: PG9
position_min: 0
##--------------------------------------------------------------------

##  Uncomment for 250mm build
#position_endstop: 250
#position_max: 250

##  Uncomment for 300mm build
#position_endstop: 300
#position_max: 300

##  Uncomment for 350mm build
position_endstop: 358
position_max: 358

##--------------------------------------------------------------------
homing_speed: 25  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to MOTOR_2
##  Endstop connected to DIAG_2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32
endstop_pin: probe:z_virtual_endstop
##  Z-position of nozzle (in mm) to z-endstop trigger point relative to print surface (Z0)
##  (+) value = endstop above Z0, (-) value = endstop below
##  Increasing position_endstop brings nozzle closer to the bed
##  After you run Z_ENDSTOP_CALIBRATE, position_endstop will be stored at the very end of your config
#position_endstop: -0.5
##--------------------------------------------------------------------

##  Uncomment below for 250mm build
#position_max: 210

##  Uncomment below for 300mm build
#position_max: 260

##  Uncomment below for 350mm build
position_max: 310

##--------------------------------------------------------------------
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Left
##  Connected to MOTOR_3
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
## Octopus 1.0 & 1.1.  Octopus PRO 1.0
enable_pin: !PA0
## Octopus PRO 1.1
#enable_pin: !PA2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Rear Right
##  Connected to MOTOR_4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z3 Stepper - Front Right
##  Connected to MOTOR_5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 32

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Extruder
#####################################################################

##  Connected to MOTOR_6
##  Heater - HE0
##  Thermistor - T0
[extruder]
step_pin: PE2
dir_pin: !PE3
enable_pin: !PD4
##  Update value below when you perform extruder calibration
##  If you ask for 100mm of filament, but in reality it is 98mm:
##  rotation_distance = <previous_rotation_distance> * <actual_extrude_distance> / 100
##  22.6789511 is a good starting point
rotation_distance: 47.088 #Bondtech 5mm Drive Gears
##  Update Gear Ratio depending on your Extruder Type
##  Use 50:10 for Stealthburner/Clockwork 2
##  Use 50:17 for Afterburner/Clockwork (BMG Gear Ratio)
##  Use 80:20 for M4, M3.1
gear_ratio: 9:1
microsteps: 16
full_steps_per_rotation: 200    #200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.400
filament_diameter: 1.75
## Octopus 1.0 & 1.1.  Octopus PRO 1.0
heater_pin: PA2
## Octopus PRO 1.1
#heater_pin: PA0
## Check what thermistor type you have. See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types.
## Use "Generic 3950" for NTC 100k 3950 thermistors
sensor_type: Generic 3950
sensor_pin: PF4
min_temp: 10
max_temp: 270
max_power: 0.7
min_extrude_temp: 170
max_extrude_only_distance: 100
#control = pid
#pid_kp = 26.213
#pid_ki = 1.304
#pid_kd = 131.721
##  Try to keep pressure_advance below 1.0
pressure_advance: 0.0475
##  Default is 0.040, leave stock
pressure_advance_smooth_time: 0.040

##  E0 on MOTOR6
##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 extruder]
uart_pin: PE1
interpolate: false
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
##  Uncomment the following line if using the default SSR wiring from the docs site
heater_pin: PA3
##  Other wiring guides may use BED_OUT to control the SSR. Uncomment the following line for those cases
#heater_pin: PA1
## Check what thermistor type you have. See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types.
## Use "Generic 3950" for Keenovo heaters
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: PF3
##  Adjust max_power so it doesn't exceed the SSR rating. The Omron G3NA-210B-DC5 SSR is rated at 4 amps without a heatsink.
##  The formula is "4 / (Wattage_of_bed_heater / Mains_voltage) = max_power"
##  If max_power is greater than 1.0, use 1.0
max_power: 1
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  Inductive Probe
##  This probe is not used for Z height, only Quad Gantry Leveling
[mcu scanner]
#canbus_uuid: 0ca8d67388c2 
serial: /dev/serial/by-id/usb-Cartographer_614e_030021001143304146393320-if00
#    adjust to suit your scanner, if using usb change to serial

[scanner]
mcu: scanner            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                          
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 21                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.00624
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc      
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 175, 175    
#    set this to the middle of your bed
speed: 200
#    movement speed of toolhead during bed mesh
horizontal_move_z: 2
#    height of scanner during bed mesh scan
mesh_min: 15, 37
#    start point of bed mesh [X, Y]
mesh_max: 340, 350
#    end point of bed mesh [X, Y]
probe_count: 30, 30
algorithm: bicubic

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[adxl345]
cs_pin: scanner:PA3
spi_bus: spi1

[resonance_tester]
accel_chip: adxl345
probe_points:
    175, 175, 20

[safe_z_home]
home_xy_position: 175, 175
# Example home_xy_position: 175,175 - This would be for a 350 * 350mm bed. 
z_hop: 10

#####################################################################
#   Fan Control
#####################################################################

##  Print Cooling Fan - FAN0
[fan]
pin: PA8
kick_start_time: 0.5
##  Depending on your fan, you may need to increase this value
##  if your fan will not start. Can change cycle_time (increase)
##  if your fan is not able to slow down effectively
off_below: 0.10


##  Hotend Fan - FAN1
[heater_fan hotend_fan]
pin: PE5
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
##  If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 1.0

##  Controller fan - FAN2
[controller_fan controller_fan]
pin: PD15
kick_start_time: 0.5
heater: heater_bed
max_power: 0.5

##  Exhaust fan - FAN3
#[heater_fan exhaust_fan]
#pin: PD13
#max_power: 1.0
#shutdown_speed: 0.0
#kick_start_time: 5.0
#heater: heater_bed
#heater_temp: 60
#fan_speed: 1.0

#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
#[output_pin caselight]
##Octopus 1.0 & 1.1, Octopus PRO 1.0
#pin: PB10
##Octopus PRO 1.1
#pin: PB0
#pwm:true
#shutdown_value: 0
#value:1
#cycle_time: 0.01

#[neopixel stealthburner]
#pin: PB0
#   The pin connected to the neopixel. This parameter must be
#   provided.
#chain_count: 10
#   The number of Neopixel chips that are "daisy chained" to the
#   provided pin. The default is 1 (which indicates only a single
#   Neopixel is connected to the pin).
#color_order: GRB, GRB, GRB, GRB, GRB, GRB, GRB, GRB, GRBW, GRBW
#   Set the pixel order required by the LED hardware (using a string
#   containing the letters R, G, B, W with W optional). Alternatively,
#   this may be a comma separated list of pixel orders - one for each
#   LED in the chain. The default is GRB.
#initial_RED: 1.0
#initial_GREEN: 0.0
#initial_BLUE: 1.0
#initial_WHITE: 0.0
#   See the "led" section for information on these parameters.

##  Set RGB values on boot up for each Neopixel. 
##  Index 1 = display, Index 2 and 3 = Knob
#[delayed_gcode setdisplayneopixel]
#initial_duration: 1
#gcode:
#        SET_LED LED=btt_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
#        SET_LED LED=btt_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=2 TRANSMIT=0
#        SET_LED LED=btt_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=3 


#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position:-10,-10
#speed:100
#z_hop:10


##  Use QUAD_GANTRY_LEVEL to level a gantry.
##  Min & Max gantry corners - measure from nozzle at MIN (0,0) and 
##  MAX (250, 250), (300,300), or (350,350) depending on your printer size
##  to respective belt positions
[quad_gantry_level]

#--------------------------------------------------------------------
##  Gantry Corners for 250mm Build
##  Uncomment for 250mm build
#gantry_corners:
#   -60,-10
#   310, 320
##  Probe points
#points:
#   50,25
#   50,175
#   200,175
#   200,25
    
##  Gantry Corners for 300mm Build
##  Uncomment for 300mm build
#gantry_corners:
#   -60,-10
#   360,370
##  Probe points
#points:
#   50,25
#   50,225
#   250,225
#   250,25

##  Gantry Corners for 350mm Build
##  Uncomment for 350mm build
gantry_corners:
  -60,-10
  410,420
##  Probe points
points:
  50,25
  50,275
  300,275
  300,25

#--------------------------------------------------------------------
speed: 100
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#####################################################################
#   Displays
#####################################################################

##  Uncomment the display that you have
#--------------------------------------------------------------------


##  RepRapDiscount 128x64 Full Graphic Smart Controller
#[display]
#lcd_type: st7920
#cs_pin: EXP1_4
#sclk_pin: EXP1_5
#sid_pin: EXP1_3
#menu_timeout: 40
#encoder_pins: ^EXP2_5, ^EXP2_3
#click_pin: ^!EXP1_2

#[output_pin beeper]
#pin: EXP1_1

#--------------------------------------------------------------------


##  mini12864 LCD Display
[display]
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2

##  To control Neopixel RGB in mini12864 display
[neopixel btt_mini12864]
pin: EXP1_6
chain_count: 3
initial_RED: 0.1
initial_GREEN: 0.1
initial_BLUE: 1.0
color_order: RGB
#--------------------------------------------------------------------


#####################################################################
#   Macros
#####################################################################
[gcode_macro PARK]
gcode:
    {% set th = printer.toolhead %}
    G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y//2} Z30  

[gcode_macro G32]
gcode:
    SAVE_GCODE_STATE NAME=STATE_G32
    G90
    G28
    QUAD_GANTRY_LEVEL
    G28
    PARK
    RESTORE_GCODE_STATE NAME=STATE_G32

[gcode_macro SET_FILTER]
variable_filter_state: 0  # État initial : 0 (désactivé)
gcode:
  {% if params.STATE|default("0")|int == 1 %}
    SET_PIN PIN=filter VALUE=1
    SET_GCODE_VARIABLE MACRO=SET_FILTER VARIABLE=filter_state VALUE=1
  {% else %}
    SET_PIN PIN=filter VALUE=0
    SET_GCODE_VARIABLE MACRO=SET_FILTER VARIABLE=filter_state VALUE=0
  {% endif %}
   
[gcode_macro PRINT_START]
#   Use PRINT_START for the slicer starting script - please customise for your slicer of choice
gcode:
  # This part fetches data from your slicer. Such as bed, extruder, and chamber temps and size of your printer.
  {% set target_bed = params.BED|int %} 
  {% set target_extruder = params.EXTRUDER|int %} 
  {% set target_chamber = params.CHAMBER|default("0")|int %} 
  {% set x_wait = printer.toolhead.axis_maximum.x|float / 2 %} 
  {% set y_wait = printer.toolhead.axis_maximum.y|float / 2 %}
  {% set material = params.MATERIAL|default("GENERIC")|upper %}

  # Home the printer, set absolute positioning and update the Stealthburner LEDs.
  STATUS_HOMING                                         # Set LEDs to homing-mode
  G28                                                   # Full home (XYZ)
  G90                                                   # Absolute position

  ##  Uncomment for bed mesh (1 of 2 for bed mesh)
  BED_MESH_CLEAR                                       # Clear old saved bed mesh (if any)

  # Check if the bed temp is higher than 90c - if so then trigger a heatsoak.
  {% if params.BED|int > 90 %}
    SET_DISPLAY_TEXT MSG="Bed: {target_bed}c"           # Display info on display
    STATUS_HEATING                                      # Set LEDs to heating-mode
    M106 S255                                           # Turn on the PT-fan

    ##  Uncomment if you have a Nevermore.
    #SET_PIN PIN=filter VALUE=1                     # Turn on the nevermore
    SET_FILTER STATE=1 

    G1 X{x_wait} Y{y_wait} Z15 F9000                    # Go to center of the bed
    M190 S{target_bed}                                  # Set the target temp for the bed
    SET_DISPLAY_TEXT MSG="Heatsoak: {target_chamber}c"  # Display info on display
    TEMPERATURE_WAIT SENSOR="temperature_sensor chamber" MINIMUM={target_chamber}   # Waits for chamber temp

  # If the bed temp is not over 90c, then skip the heatsoak and just heat up to set temp with a 5 min soak
  {% else %}
    SET_DISPLAY_TEXT MSG="Bed: {target_bed}c"           # Display info on display
    STATUS_HEATING                                      # Set LEDs to heating-mode
    G1 X{x_wait} Y{y_wait} Z15 F9000                    # Go to center of the bed
    M190 S{target_bed}                                  # Set the target temp for the bed
    #SET_DISPLAY_TEXT MSG="Soak for 5 min"               # Display info on display
    #G4 P300000                                          # Wait 5 min for the bedtemp to stabilize
  {% endif %}

  # Heat hotend to 150c. This helps with getting a correct Z-home.
  SET_DISPLAY_TEXT MSG="Hotend: 150c"                   # Display info on display
  M104 S150                                             # Heat hotend to 150c
  TEMPERATURE_WAIT SENSOR=extruder MINIMUM={150}

  ##  Uncomment for V2.4 (Quad gantry level AKA QGL)
  SET_DISPLAY_TEXT MSG="Leveling"                      # Display info on display
  STATUS_LEVELING                                      # Set LEDs to leveling-mode
  QUAD_GANTRY_LEVEL                                    # Level the printer via QGL
  G28 Z                                                # Home Z again after QGL

  ##  Uncomment for bed mesh (2 of 2 for bed mesh)
  SET_DISPLAY_TEXT MSG="Bed mesh"                      # Display info on display
  STATUS_MESHING                                       # Set LEDs to bed mesh-mode
  BED_MESH_CALIBRATE                                   # Start the bed mesh (add ADAPTIVE=1) for adaptive bed mesh

  # Heat up the hotend up to target via data from slicer
  SET_DISPLAY_TEXT MSG="Hotend: {target_extruder}c"     # Display info on display
  STATUS_HEATING                                        # Set LEDs to heating-mode
  G1 X{x_wait} Y{y_wait} Z15 F9000                      # Go to center of the bed
  M107                                                  # Turn off partcooling fan
  M109 S{target_extruder}                               # Heat the hotend to set temp

  clean_nozzle
  CARTOGRAPHER_TOUCH     # Calibrate z offset only with hot nozzle

  SET_GCODE_OFFSET Z=0  # reset offset utilisateur

  {% if material == "PLA" %}
    SET_GCODE_OFFSET Z_ADJUST=-0.2
  {% endif %}

  M109 S{target_extruder} 
  
  # Get ready to print by doing a primeline and updating the LEDs
  SET_DISPLAY_TEXT MSG="Printer goes brr"               # Display info on display
  STATUS_PRINTING                                       # Set LEDs to printing-mode
  G0 X{x_wait - 50} Y4 F10000                           # Go to starting point
  G0 Z0.4                                               # Raise Z to 0.4
  G91                                                   # Incremental positioning 
  G1 X100 E20 F1000                                     # Primeline
  G90                                                   # Absolute position                       
   

[gcode_macro PRINT_END]
#   Use PRINT_END for the slicer ending script - please customise for your slicer of choice
gcode:
    # safe anti-stringing move coords
    {% set material = params.MATERIAL %}
    {% set th = printer.toolhead %}
    {% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
    {% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
    {% set z_safe = [th.position.z + 20, th.axis_maximum.z]|min %}
    
    SAVE_GCODE_STATE NAME=STATE_PRINT_END

    M400                           ; wait for buffer to clear
    G92 E0                         ; zero the extruder

    {% if material == "TPU" %}
      G1 E-1.0 F1800               ; retract filament (1 mm for TPU)
    {% else %}
      G1 E-8.0 F1800               ; retract filament (default 8 mm)
    {% endif %}
    
    TURN_OFF_HEATERS

    G90                                      ; absolute positioning
    G0 X{x_safe} Y{y_safe} Z{z_safe} F20000  ; move nozzle to remove stringing
    G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600  ; park nozzle at rear
    M107                                     ; turn off fan
    
    
    BED_MESH_CLEAR

    # The purpose of the SAVE_GCODE_STATE/RESTORE_GCODE_STATE
    # command pair is to restore the printer's coordinate system
    # and speed settings since the commands above change them.
    # However, to prevent any accidental, unintentional toolhead
    # moves when restoring the state, explicitly set MOVE=0.
    RESTORE_GCODE_STATE NAME=STATE_PRINT_END MOVE=0
    
    {% if printer["gcode_macro SET_FILTER"].filter_state == 1 %}
      SET_DISPLAY_TEXT MSG="Filtering"
      G4 P300000  ; Attente de 5 minutes
      SET_PIN PIN=filter VALUE=0  ; Désactive le filtre
      SET_GCODE_VARIABLE MACRO=SET_FILTER VARIABLE=filter_state VALUE=0
    {% endif %}

######################################################################
# Filament Change
######################################################################

# M600: Filament Change. This macro will pause the printer, move the
# tool to the change position, and retract the filament 50mm. Adjust
# the retraction settings for your own extruder. After filament has
# been changed, the print can be resumed from its previous position
# with the "RESUME" gcode.


[gcode_macro M600]
gcode:
    {% set X = params.X|default(50)|float %}
    {% set Y = params.Y|default(0)|float %}
    {% set Z = params.Z|default(10)|float %}
    SAVE_GCODE_STATE NAME=M600_state
    PAUSE
    G91
    G1 E-.8 F2700
    G1 Z{Z}
    G90
    G1 X{X} Y{Y} F3000
    G91
    G1 E-50 F1000
    RESTORE_GCODE_STATE NAME=M600_state

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 2750
#*# scanner_touch_speed = 3
#*#
#*# [scanner model default]
#*# model_coef = 1.3647559284878394,
#*# 	1.7110854464769716,
#*# 	0.7613698454492615,
#*# 	0.11961413535167648,
#*# 	0.5141627425398672,
#*# 	1.3440769142927633,
#*# 	-0.4245943273247019,
#*# 	-1.5457707753686503,
#*# 	0.43264489827812025,
#*# 	0.821202509557533
#*# model_domain = 3.0396570170266874e-07,3.286702476106632e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 24.479958
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.010766, -0.037009, -0.041049, -0.033642, -0.023152, -0.017232, -0.019421, -0.022405, -0.025440, -0.023767, -0.015852, 0.002051, 0.025346, 0.045103, 0.059079, 0.068304, 0.060952, 0.034399, 0.010207, 0.001154, 0.005696, 0.008770, 0.005693, 0.004787, 0.007586, 0.015494, 0.024607, 0.031474, 0.040755, -0.169883
#*# 	0.000698, -0.001452, -0.006857, -0.004231, 0.000385, -0.001984, -0.011915, -0.016980, -0.020764, -0.020491, 0.005792, 0.005792, -2200417551709471240157320940427978178007000956445547135908298746813108119928832.000000, 0.005792, 0.005792, -8151952326869423408118963347972608513870041182527596567210452966364421045140263619384908837775778684926703972553057698721078118305057700186134881656121376418853948457311147849881457709637603861131024572351378259248310232002336915456.000000, 0.005792, 0.005792, -110818972050129585931169959008834052324712764539303301104784542097390323235180740532125667276904352414316822230204416.000000, 0.005792, 0.005792, 0.002342, 0.003372, 0.006237, 0.009411, 0.014714, 0.021102, 0.024813, 0.030971, 0.017453
#*# 	0.008091, 0.030106, 0.026985, 0.022135, 0.011092, -0.002785, -0.015635, -0.017020, -0.017050, -0.021646, 0.005792, -4195499413554946397842399811855649924491551160578941058572414482608149636317184.000000, -27951557209271307177310380638419783308392719283567691198270891874176352748879470231616165478188010999100236241408786078901641884351399093908773026767028698974585549665447727597364522817609455521598280586166136167354754448302322745344.000000, 0.005792, 0.005792, 0.005792, -402646616727827877746656404692948511324155733790747867506228203917509364492432022528898187351031808.000000, 0.005792, 2667519208799653168657970698614105271803852090267452009686020482125641758467043722704241516738142464734454790465365500493824.000000, 0.005792, -0.000704, 0.005630, 0.014788, 0.026018, 0.032024, 0.031887, 0.032067, 0.030217, 0.030481, 0.012947
#*# 	-0.002444, 0.055153, 0.058331, 0.052557, 0.023605, -0.003894, -0.019026, -0.015592, -0.011574, 0.005792, -1029966713211599728264497234947840000476207802843499576939894447599498754787549547292727785429702471305869362697601024.000000, 0.005792, -10093120648062588430925432431919299350661451373574715236080425809306096619866743163177426370420291186949039433380675894730906748940362404048316511016937008784220455346974506154302453610692889307283095609196018119473192659270852673536.000000, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, -0.004988, 0.002989, 0.018638, 0.040350, 0.051269, 0.045200, 0.038404, 0.030819, 0.024963, 0.008097
#*# 	-0.005406, 0.043490, 0.058205, 0.056376, 0.021815, -0.012683, -0.030203, -0.028947, -0.023759, -0.023369, 0.005792, -12423331025753705432834061009626150643836203920358791289919880373099753500952942534445552865868729993643888252601529795536083466215891402072346443011352169866947312580932627336292609546037856358766432339322566460364315955736256446464.000000, 0.005792, 0.005792, 0.005792, 0.005792, -10869273091256261310586276317809668257345253644764840327656751915477222920610996146133639331600097960610117171005276497569327257481855502397467137507615378713726786687487611593201058492081902027786455971877316269566234331219713064960.000000, -79795855068435949124040256551558793539124755966454611751878165832407061913147386131378723643439213351727588846718408327232357645568664082308057986415687784046800399451646025844884042859663367358339423744173277184.000000, 0.005792, -6924766755238146677805759112773869725842922872551004877084085671861581138191696235586229756928704159844297214606509188114158825687711781650417308391980466775018659635205795975416572326359487831673509057088306566782087619583102100961134701588286143232196363486505205760.000000, -0.004177, 0.002390, 0.020687, 0.045199, 0.057734, 0.051532, 0.046330, 0.040389, 0.034865, -0.005633
#*# 	-0.012472, -0.004795, 0.012046, 0.015464, -0.005643, -0.029647, -0.043165, -0.042715, -0.036196, -76196347896840259832112257984798898003709049391241453911163048084952312626930461435599983483487999016933927196743557426366691154110050511348073776060848860751349349621042780928439796478454418471776216416256.000000, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, -76318819600620292100513973034775310199080821444251926022658825447767733548709681457753817839009829601555528628205364868483738240373635020408499394666139152485540630198360463609207758084714913986974368923648.000000, 0.005792, 0.005792, 0.005792, -0.001581, 0.014215, 0.033497, 0.043862, 0.045135, 0.050396, 0.058390, 0.061657, -0.003666
#*# 	-0.018634, -0.045297, -0.031513, -0.022483, -0.026512, -0.037972, -0.043157, -0.037708, -0.031845, -0.027161, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, -0.003565, -0.004358, 0.006777, 0.020928, 0.032794, 0.041258, 0.059980, 0.086649, 0.103421, -0.002470
#*# 	-0.019570, -0.076235, -0.065822, -0.050928, -0.044893, -0.048813, -0.047385, -0.038023, -0.033277, -0.030021, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, -0.013982, -0.006418, 0.004844, 0.017761, 0.030660, 0.054856, 0.094613, 0.127197, -0.008764
#*# 	-0.023530, -0.083473, -0.075230, -0.062373, -0.053313, -0.049642, -0.045394, -0.036626, -0.034060, -0.029804, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, -0.022264, -0.023369, -0.016731, -0.008269, 0.004728, 0.018531, 0.040597, 0.075457, 0.112723, -0.013303
#*# 	-0.026002, -0.089618, -0.081209, -0.073865, -0.067031, -0.059176, -0.054185, -0.051129, -0.048616, -0.042584, 0.005792, 0.005792, 0.005792, 1918610241669246222336.000000, 0.005792, 0.005792, 3121762405504220397568.000000, 0.005792, 0.005792, 0.005792, -0.026114, -0.022722, -0.016005, -0.006922, 0.006635, 0.017171, 0.026571, 0.048561, 0.074879, -0.018774
#*# 	-0.034855, -0.074536, -0.063680, -0.062957, -0.062841, -0.055764, -0.051956, -0.051597, -0.050333, -0.042698, -79209644490167866460976771239574453914907193675733257110137784929574111861806147498485961724155533674602717164359097932051981355314778179959971254800882458798698433788478915716877262475831465183408971640846942208.000000, -79124244334537757202282595456207371685131467293593342635454338588694943163434441591438641602375362031244340992235154585021654422058798459031817798702628297544117928872106055200032454079860927219806956926953062400.000000, -79096633757902506547903285566121247095894763869625016235716282280760451467152889785097236943862956907433841289974544455761399224413094141342225897032383145297436064701882251809587879274793449509533429341527998464.000000, -78245842733590277916561011893295259890192122208439618196628254078759416246404390071962237985550242870705535733111112739845361739092320797434435073589159839777375256409725834935989044933418602233198557367673815040.000000, -78259326968718315875959361204833738464880133224891947827311966106541881538830839797906959731962928994637517570142755904521412842274981233214883134558265308625562718105083701694411050365588492284026055227397373952.000000, -78295284928959035883870355598336254352552875394652487258802772327075673132154037770499401437745200977531628651492977683665743336945466667112870440028529109547536638347089274319679680683318798462527637621317828608.000000, -78377474552440612993124042529615206073138452544507434824816927234156216196461657277019246971474474721965216194643072359627123568599030423162581046171180002032231768166381901567604520572066354982648695961142951936.000000, -78325463931320288356401652286553256176878126387463224048439086781015715846747331822799382275847173656530019142982008184238761057866964075784079503120168560484020786155674255110611723277935108477419444068199432192.000000, -75320405822835645599612658048533556295635729217486114553299435384512260266513905639235935664700155112504167151168109707658489872192697170573039220191496573746484440057884458489507707626697867728034483723785207808.000000, -75360858528125722685742170448699523089570317951924753720275218877234173405104971567850950815300168286920327905491460820981775538112800546651784394007199458814394415567324575348396867948382303354573640710773276672.000000, -0.027538, -0.022533, -0.017049, -0.009416, 0.001219, 0.005719, 0.008471, 0.018760, 0.033584, -0.012796
#*# 	-0.027866, -0.067418, -0.058119, -0.060663, -0.064140, -0.060942, -0.057202, -0.055811, -0.055088, -0.048464, -9476160736555615020530462009972364017714177359760780164277606110121992993262282906753593050409654896681835098703493223635880104756146323512945032737697532206629098343462646161924271373460535946059749102527200800800768.000000, -81406290598993181474917311853998757608105191921378699825047448237297593697670867798044702593136695790914912610649002658422521760528431723474852443039093070746634628316459228475837877732521050750501838422114566144.000000, -81436469601372075189839281345180842633949162197433260569467374147030652251954491617288816516229589508531450322009330852037152171351502416548266089712307077381441485711757644947425673912239710008734366201074941952.000000, -81446743304307178889712143309032633827827874599198795201899315059908341873130177478448372774232873085491272985136825219937824633094736163149807221711168234727524549028222647952565348000106976876486041283107749888.000000, -81457017007242282589585005272884425021706587000964329834331255972786031494305863339607929032236156662451095648264319587838497094837969909751348353710029392073607612344687650957705022087974243744237716365140557824.000000, -81467290710177386289457867236736216215585299402729864466763196885663721115481549200767485290239440239410918311391813955739169556581203656352889485708890549419690675661152653962844696175841510611989391447173365760.000000, -81477564413112489989330729200588007409464011804495399099195137798541410736657235061927041548242723816370740974519308323639842018324437402954430617707751706765773738977617656967984370263708777479741066529206173696.000000, -81487838116047593689203591164439798603342724206260933731627078711419100357832920923086597806246007393330563637646802691540514480067671149555971749706612864111856802294082659973124044351576044347492741611238981632.000000, -81498111818982697389076453128291589797221436608026468364059019624296789979008606784246154064249290970290386300774297059441186941810904896157512881705474021457939865610547662978263718439443311215244416693271789568.000000, -81508385521917801088949315092143380991100149009792002996490960537174479600184292645405710322252574547250208963901791427341859403554138642759054013704335178804022928927012665983403392527310578082996091775304597504.000000, -0.019257, -0.015556, -0.012730, -0.009712, -0.004297, -0.002241, -0.000652, 0.003303, 0.011169, -0.016458
#*# 	-0.033657, -0.053136, -0.049196, -0.049793, -0.051220, -0.048093, -0.046098, -0.042543, -0.041611, -0.038003, -9468417816282834462839198192109703104625110919711476189667470032066729898283162491866505630352307105626186158608787079985590630857020850623122794814073044378677259412195997298262986322921883507539420720593529647136768.000000, -9459749112544057804848641030571384457382024725873147642099453158854339236984036257883840713880328567784297221215179723269944016347022664279263042995005209445935594167742036632572567710535299425296312470280809520037888.000000, -9475234952634003176806793190290808404828199516192769946608761293106312847072756828309111114951901394029133820375164284715727538983385104468762885997546871842772530557635040129995018114486773152689702117917146786824192.000000, -9462610626470522226788326367008869592850145979367011396471531268505087093848873417713621509676624673513011887595974277117523098294199478275067558141677389379358796074141250857013755843560040790373995593072800792838144.000000, -9470690195216495856023248919023588745978373301367651216074680363266741619832224116025769339736276965855445900695300202491823226378894403186980231871363861092360630735394442367693099993060783672113592575886551349723136.000000, -9475739925683177622118000660865768944995243627641864887534758448228228556094699695784379697871033367249973171604564969212720655270613222227867743979742437321992891187813063894283885744236985183968041293787302096535552.000000, -9468922789555613537982049400876711328513731469269383878079459637123183626697436686141926832682263291448298129416992967687997303400853404203875771388628299832488415575654241158779554518837114645463709105672407098589184.000000, -81077532105093633905596889821516424395863313421116913695789696834288555637936737469278878273587184422609785763107626387241820083849614139174269513901555987841750422734387914287845127429508117166271750134357295104.000000, -81053774167074595352302360553538862631093388211008609319633072533110940323560426299534932981648517318263349312626733087269128243677653167797791779887525750893286671689348633725922831872226833356044380522797858816.000000, -81051205741305237938444482968459899561763920369787309549334413351681875800924992253459419559284652295285096711850208216108334533355620649048044709663956696673708237371776470330603427305731549521181956014707048448.000000, -0.017797, -0.016687, -0.017997, -0.017318, -0.015139, -0.012307, -0.010067, -0.007177, -0.004103, -0.011209
#*# 	-0.020577, -0.055179, -0.051476, -0.049755, -0.050473, -0.049985, -0.048295, -0.042639, -0.041482, -0.038495, -81212374456100125736362479758663647217469747933922536399545662984886047390059843770745995638532966486095318482540859952203734099577216318802150147987148082770004667121364766897816532870634951455900953474234318848.000000, -8256398342526912803235386177255251631905560289905821536711938614962977046740061689831630360910292966265865270901770961270158766570550223051095233321022380052565883594237173688013812416509831424654062079757979582726144.000000, -8272220831128693638291662188269378463357152095377251050515581044623551269696274078731466120321576774145371405936360744867704720882450036342370911293952843320684789142530407855393680916573287601077412804004796749053952.000000, -8260774775406650040074508983107762223758436064148454579217485960884644637257689116922033055124882334614208193592387410920936583658289685626992536452835142435558102180285626866884551847128576300604595127769229827244032.000000, -8261363910628681616702421959941025533855680456360947576754796091393414753017903515173234160629998137471448334242190993440701068601668373423118011816199824674031008405262928725924339062884314399674780117932613700681728.000000, -8257997423649143238336245908348769369300999386292789184957753821315609388352832896856596807919060986722082446393087488034707671726034427319903671935962385255170324817846784085792187742080543300906826884853454086340608.000000, -78335095527849605955051735534855330694706902886153221509013252737022515377978444155642098646736441773865083700479204266117661385935915693006141669984281342989106719655046514079805713610259269555919973749423603712.000000, -78283084906739447458012105890112242304406516655046129621832747699084769918933122295932412339070010459497971487388040456210906188028484797656029208997228119978912214355326271235394198043136156512954866352932257792.000000, -78355642933698285058998672313177794599255043140640980184988659565877943087148396501351421635296461219640549368586168698546190823440802228972635289611268606659590895605885547734030582834682461841922782626884616192.000000, -78251621691497851838122459488050567528840623768862631885087143757972546293454480400606368514063535015789490876665557970042294730650595072386759601674021617485616464455876307346285646842966849733656262216668676096.000000, -0.004921, -0.008663, -0.013287, -0.013726, -0.009739, -0.008399, -0.005263, -0.003359, -0.001779, -0.014303
#*# 	-0.021763, -0.041278, -0.037035, -0.033997, -0.036492, -0.038557, -0.038200, -0.032934, -0.030300, -0.025234, -8771891660806208720547002405819919429393566144110817811341357989628993048698661464821680536433350712657443851732873093309179538385220667760920643189582652612119301921286967840377563916880288790560173117223577722028032.000000, -8772480796029455220235958403577545806390358142945232322360758342896149051515428710523728146399378889643268595170678246471195854061042566057523042867444425445494024755068351168698406030112341952693371765346030982266880.000000, -75432774448662627963656867794179519845961945122661584169906999539481492833489607712495778078827692806330012937448272549765676425364650130661470026208440282387814503989222878544046709770901996807165005618963546112.000000, -75371132231063816426698197294409802961672542096612970378941670206347967405889187897984088952115472378900175521139514119906450150686809426202851726613107151024599972034079991180766330779487256534755946527056723968.000000, -75366637486043163742878062153587843366356408263992618095307992930026447904863212444107901543893128131570365392363750523557915627412632760337545384095314801574239851009433410088551772710614915686052426982795247616.000000, -81475638092385459942772444203587923746263125093606632537817503770319639202476480692215031274711519403885868129998209191555839662843226388600215035805711129347335557944709988391826982536371640965762172603632451584.000000, -81491048648215561105684651748608105520985699767543333810820687850752404459352455371942354606575038639885514458004284414265475162070125478606334903608018609498538382868050576619037639689843986821772797757936893952.000000, -81526364502030312235061504474016106154599801769500232393370773804821601400373499150646278743262156686769699004210435122976019004958596635715541389845969925246688344528503118624559512235176804602116477294856896512.000000, -81386385299563743657067395759589209431612790413118547438985113238375525786683876091033337946344784122354317334514851701623774135436315415160705691278563588805698801359019796580092741608210552659688013249590067200.000000, -81424269579131855480507193952133258706060572431660396951479227647010628819434715906804112453751457436859620985512537000516700181702172129739694074492384997250371858982990793355254648943717032503390242866359959552.000000, -0.004347, -0.010886, -0.017385, -0.017536, -0.012099, -0.009098, -0.007665, -0.004963, -0.004126, -0.004073
#*# 	-0.007853, -0.044333, -0.042380, -0.041249, -0.042053, -0.041804, -0.041389, -0.037048, -0.033501, -0.026067, -74893405044585979444234863298089245463647683028899633010208183381889556590632591057525095773180816822798459114491864409061183905872602908655478389576633136727921267543892970682616168808515876652949001313907113984.000000, -8770797552541234078179038097991493244839860526026182151705545717500996128496888158601165499921524468400169258024386559586552294782306457998459050682894579236019223479029995559490448706817373983663880293625265393762304.000000, -8784768473494786377085381328002781087896887507179994144046979265851144931650780406472901354393737318612101583876570553425211950105819118527916787652306762258166559168723093482621121733881872194960829151082611113721856.000000, -8771639174282562083487044880280333146587113203190338609380622810332592009973408364594379022620942693114315481502432031557910204034465868623672929796805198075013753819465631934450720990373942823743981845127779592437760.000000, -75300500687995112233331879271934243007103675108303973664227119393321040972812549911320597540745907081731100835964708218774936232699316661993273223732411261833069816041422390436544795141096817799990866891679727616.000000, -75330037419339996355218314533317250350298182662771717094815439364947588228013788556149243347509051929422023355118638715486972240824676427666557611986770790136147555752331770351332961952987348097739246774016540672.000000, -75380763827578034317878297889326509654472584293543423607031558560362439820097221362510216835004036895384114068407887600114139617060346622029806580411634932465867315124485665372449887958461101735481791000315166720.000000, -75387826998326333342446160513301515257900197153613661394992474711619367748219630820280450456162559981162828710298378979838637846567242701998969494684697174781297091020153150920128297625663002360640436309871034368.000000, -9474393330891675799303412310144831141599060904549290953650029339618625348823910892961169016002377829305990584926343327216065704451312730367350246560420904288616828490602498030303555512038396760735186105835398092554240.000000, -9473888357847321855169891664527827286226996006471045888798132100602563320703774484726355918524930437305019173791271455267362110102488318787557056019617020847232707953421313644129841185178079979674610798641550349828096.000000, 0.001279, -0.006908, -0.011874, -0.011613, -0.006875, -0.004196, -0.000778, 0.000359, 0.000862, -0.006006
#*# 	-0.008591, -0.034753, -0.036250, -0.035093, -0.033100, -0.029926, -0.028819, -0.024906, -0.019417, -0.012560, -9089435544980288311177519710716304181162567487244518150787736808124201302910399666841011241775221158788318602743582266647304651186039305450098748304378250631757050934576239528937592578827668187085348104551198340677632.000000, -9089267220631301594492589593451817477234030630461901186734319450888388567846044903284446741039183072427232690586707723871825531094415324189289023856217208575371260169650560672178718441033638381638377752107247864905728.000000, -9082197597982559910485252108511395294548371957529620180136726880931404241161039418879315903361794640634068954802375271901054307330156263851599216317916478080335896015498051468318720371095417004478172370974663491190784.000000, -81214942881833602657222378761440746148117074860071651855030197171481859357392912189138526515152585328833271653070677651076501999929947242157582810926158718620113183635451976366378472518277999541595809171317456896.000000, -81225216584766912332445341796177444135061680216083577271721431834617886350803479768913933645868656596781079344685836660362773171174715908989408222560791955047722751061742731675180273360202654621889105812799881216.000000, -81252185054972456556936553915845942622460353793594910289725629855792652920272214295149843386770882140806621321151677055409239028499937033703311554239916453540427540212550488411840854463825536043466442123411193856.000000, -81299700931048507185281806451403872365438803348929580775217160744346409170053173590602223831560876890253811119124562079359450024394703164915249769977467920211710705311317292441503762617506719831790191671513186304.000000, -81309974633983610885154668415255663559317515750695115407649101657224098791228859451761780089564160467213633782252056447260122486137936911516790901976329077557793768627782295446643436705373986699541866753545994240.000000, -81320248336918714585027530379107454753196228152460650040081042570101788412404545312921336347567444044173456445379550815160794947881170658118332033975190234903876831944247298451783110793241253567293541835578802176.000000, -81330522039853818284900392342959245947074940554226184672512983482979478033580231174080892605570727621133279108507045183061467409624404404719873165974051392249959895260712301456922784881108520435045216917611610112.000000, -0.007558, -0.017576, -0.022678, -0.021264, -0.016682, -0.013367, -0.008892, -0.005444, -0.003328, 0.001280
#*# 	-0.000678, -0.043346, -0.045709, -0.043727, -0.040458, -0.035294, -0.030561, -0.025046, -0.022533, -0.017126, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, -0.005417, -0.014125, -0.018788, -0.016792, -0.011965, -0.009023, -0.003798, 0.002277, 0.008023, -0.004663
#*# 	-0.007146, -0.030545, -0.032802, -0.029832, -0.024267, -0.021898, -0.018009, -0.011103, -0.009433, -0.004415, 518931555243519121344181497156201826759220903074909852053008335900401105439183512440694138779861675010464185283078941739267196727487621843596280660658661919543015577306643011743174808162202674490348055105772070646715488743279539425663229311844352.000000, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 421561076663823283163006522261318992284591632211345705548607025550512626504199364357133934828061832546114773501157065918925453720220650620261847007232.000000, 0.005792, 0.005792, 19490628022799998160706764775750376621752453715190015053735812914425897381532852204931230131764020518450609832462817336366918339730406188093155974592625306839062555399912946059741579310980107296705599186958436757747371195850789749891492727230937931225655477606208555094163657179983828221952.000000, -0.014353, -0.019419, -0.021056, -0.018533, -0.014460, -0.009196, -0.003580, 0.003830, 0.009604, 0.006085
#*# 	0.006401, -0.028625, -0.029866, -0.023808, -0.019452, -0.017975, -0.019969, -0.015727, -0.010828, -0.005934, 74773057276112598501366053637603212852660979187247766645017878494485163675411243457086990730048341515853351436251467501912890080761360791483408282890789735708695415466233168169419022646395549681580228773074008921491574515543784249947280668134211584.000000, 390467284052971239912152323338630864126457712904821833715426583207982699381393612685876804912205732187770331302131380032201795831615977421493867638399886036844306935345194249689364209676490454821298757036357644049867317166588458696704.000000, 0.005792, 73372076068970734930159660886041301788419523793823232600821585276092700640801207901631326417650018320072260147421411769344079666726928569009153523136942293256841071327840193569962885305835183737693255370683978910496553172992.000000, 1521489975595301550732006652051209568290204536107851307370160691728664644572766880309962105844387327101329164330833508278036531851162058635342599535952194750248710142136931983794948537619184296725194102853926944197782793336389632.000000, 73372082546039077301749379027234194072865956119234148807136717169300890634484546095341796727313307765480799565766890470399128047653406470272980409999377011099034555920204861013973141289140352008554033282690924435350950510592.000000, 0.005792, -98245336685888870245034282988193714909033801358515062115318162343896510164477216586765774008605627576667284791464956571070251643212711067648.000000, 0.005792, 0.005792, -0.001517, -0.005109, -0.003297, 0.000859, 0.004667, 0.007476, 0.012572, 0.018549, 0.026271, 0.003753
#*# 	0.003634, -0.011211, -0.011043, -0.006317, -0.000616, -0.000614, -0.006030, -0.005227, -0.000887, 0.006680, 21280559933189630424513604814760966390434090090456906708504427804526057775298106484683595785500828574049703708869462202017622637477800701418634881054217944060672889840736415022322837192336460474239655082326148323524596548332828853465664978944.000000, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.000418, -0.005142, -0.002452, 0.006551, 0.011441, 0.007738, 0.008825, 0.015584, 0.022490, 0.018263
#*# 	0.020115, -0.006545, -0.008628, -0.006245, -0.002695, -0.003299, -0.005839, -0.005413, -0.000875, 0.005434, 0.005792, 323790720817821509899185847432903514125745748119180755620058317401291171604108597846402183809103706469962606428419141160459207270344452011652148540860415579521024.000000, 3852786081670216039711204364520967908008866875477750230681057626963366643627245463233961965067100350500512943828536828096044994039148519369051179366964190980406723675710183410697571524291207456461765131743627701584709520351444336640.000000, 284396478872575149673542644775264491667901977411005523232981090515804005718067704651284066737075926691180709370989348532827521079548696634279524787004983632674726102472794792294585672035749930578196321689087841178041101062662186424760780455936.000000, 41777314393753191568061025747932958790114431361906235256129609136559865290680943983089577885562972191357585531597112583900005826771859633975286934701654911234137835366707772834309807738273785750487040.000000, 63696276330954315508299785895156677633218694994501421969689823938108704871962444709099458518971156911241896873100455030790032304197570744001513595600896.000000, 1232545534515169748494679731773857228176811675969439566335015683771402565188980801954241537791657298618044708024857528866059150324534095083694532890604390620220809929555968.000000, 0.005792, 9703780813112902022695788301629469117350373879174955403123401101622077463335781660541506602723897718738654936543870908379282692552124530615325661969269296968892808605320419094441202687148032.000000, 1084379179133967239903571292550623651894980570195688388468266034887491214550034143617812236674593150831249475862312087536374667650900230326441342576333008633522682505749938873578957287400694755955488946968015801573738158770527015112664276233355264.000000, 0.023970, 0.015603, 0.013872, 0.021919, 0.026940, 0.022074, 0.021993, 0.028115, 0.032435, 0.017565
#*# 	0.016781, 0.011023, 0.007089, 0.007723, 0.009811, 0.010486, 0.011513, 0.014078, 0.016912, 0.021676, 0.005792, 64727654847426850393493804455001437121805039268032598519509803859968.000000, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.022763, 0.012606, 0.007692, 0.010594, 0.014511, 0.014850, 0.018247, 0.024008, 0.025711, 0.031317
#*# 	0.036239, 0.011938, 0.007110, 0.005373, 0.005442, 0.010129, 0.013056, 0.018796, 0.024338, 0.026241, 6989026001626931166353689903121576753911503647811006278458885789491443701653882133693027592981571589962994073275713409612067804731694759910275543797506338924986618824190521238231950598829840150056205739405282469635833282512814080.000000, 0.005792, 97538806975312947967612031737372942286504721449782242999213482850263423470113797422833290829288430903717337480794540255921232869242886250599997387864765989690112785097838488159721670554264014107443200.000000, -338460698192729075070015183908362671761304475671532951972270467106229287344773121610555015661017876632814410602214872756256768.000000, 3943587151232457404644385130279721735055984687237931465592423583122570676074557283905856792360571270328751652019372646582649453984185473077620077760010006548340577204809911259627520.000000, 0.005792, 107212151106457125473902023195082601733513448731978294955321893622627958784.000000, 0.005792, 1123129978510723219819012058432952116160010909928957840148435276576831082527571014939924617130676982674047932067274479371648560030456144553297993522835005444440978529468867745906356740749667993730170881719791590643335168.000000, 0.005792, 0.032750, 0.023766, 0.016540, 0.015298, 0.019587, 0.022923, 0.026569, 0.032919, 0.035132, 0.026189
#*# 	0.043667, 0.028637, 0.025021, 0.021364, 0.022590, 0.029011, 0.036570, 0.047167, 0.054369, 0.058054, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.033477, 0.023749, 0.014428, 0.012157, 0.018596, 0.023953, 0.027239, 0.036381, 0.039504, 0.042797
#*# 	0.056992, 0.031873, 0.030930, 0.028665, 0.028139, 0.034630, 0.047318, 0.064047, 0.071317, 0.005792, 1953510973581098771220821242670758962928637979411474561368064.000000, 1949327044115915511378616791458175458083372612160810393629716739217788362471681571691562920966418315403110505711100832088818153943309266583412390961923614397886912571323291168952213107458315954324544170286656086388135459229722797815252469678080.000000, 13336030229345471267831478380487771558410999485279364867873495804809261249787747063796974843209032887157003956407869503532374532137108859267630733494331172798372473437315164931708355618229596077235774965976124284803190649172437586978824781824.000000, 0.005792, 14173683770411076739327541456536737202365376553693526692965641749043593772322557297500815405337842283714735413950391417995595292853122742722912009433845732276001556286603700853985161886302208.000000, 53760866365101251757466807263788303908632949461817044848467748596171892466445203726996576098315125621659546791837129321645111986765447103713478721903480393785654741711136988297942164512155425259543380084204056186702589635070608023534530723840.000000, 54275130310215350326960846797569576810513867914685838084862325063405152737164539299786537984707649398452295163958752277545891807663794877854010324992218332617502853553587090321533940464280618536198757562800518663600565971157796360902827128450449408.000000, 67702353460448184407604206010142605671794865171583075690544540492259814020752849020294192986614055652067635769558024063014054357920957826987464597187094211692688592619471325364674841633604738796850493434897974787163472003072.000000, 4262282688446074277837488960205318555895942645273749762647811514191322722124477710444487145720451230023393680204036215016729374284098914072645088767965536247651192105347851141251072.000000, 33439707220260145093385440534459836233385056900680862706976565922402372690534209783723015968931754175017670362797553583009984056387353371796547311763456.000000, 0.038762, 0.029052, 0.019076, 0.017748, 0.025159, 0.031266, 0.041092, 0.057344, 0.067177, 0.047120
#*# 	0.061047, 0.050505, 0.050605, 0.047946, 0.045663, 0.050194, 0.063659, 0.083902, 0.088644, 0.085117, 0.005792, 9004169288478775734644448215413063737944685333475539266192820888363428220518984669069740218674942762631987545600247073905331927085686929095555458638010272760341523857408.000000, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 39191066485258739495582803211213116836177854260974927689867324404930562930532401964915294470471057677470020717800991369135822596029816596680341771026342219486499009066287015365002034290763159969980219392.000000, 0.031539, 0.022683, 0.013894, 0.012022, 0.020210, 0.033136, 0.051459, 0.076883, 0.094305, 0.060468
#*# 	0.068650, 0.060393, 0.057212, 0.052637, 0.047766, 0.048318, 0.057435, 0.072336, 0.077604, 0.072684, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.034401, 0.027064, 0.018407, 0.015703, 0.025600, 0.038158, 0.066062, 0.098373, 0.116986, 0.057965
#*# 	-0.139205, -0.197298, -0.194913, -0.191680, -0.193272, -0.193959, -0.185069, -0.170310, -0.159958, -0.154446, 0.005792, 0.005792, 0.005792, 1277340672208501385319182312438773106410971428378410593839240698155665296646239161731946286016605106868173585943256538641120672231194262532066821969019639263713136344014735249821668498148685239527563971114825719484589550579022057702455501761847580166690900226081263688420464142721086355375390720.000000, 0.005792, 39191066485258739495582803211213116836177854260974927689867324404930562930532401964915294470471057677470020717800991369135822596029816596680341771026342219486499009066287015365002034290763159969980219392.000000, 0.005792, 0.005792, 19490628022799998160706764775750376621752453715190015053735812914425897381532852204931230131764020518450609832462817336366918339730406188093155974592625306839062555399912946059741579310980107296705599186958436757747371195850789749891492727230937931225655477606208555094163657179983828221952.000000, 0.005792, -0.125550, -0.125307, -0.134746, -0.135466, -0.120024, -0.101669, -0.069834, -0.031386, -0.007095, -0.125725
#*# 	0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 66185513792061519228766652518595220008098628663029149620042178438006965789714499700283803920970686572708573514225354333550840010724232564415628080202502517257757536181477349062514048032509768822249889823711352664210732085068695792603268134460421308416.000000, 0.005792, 0.005792, 0.005792, 0.005792, 494781569743803357444276771785886004674772039681477005921834150787402310186260283103899558177691775059756669840033263121739522727321660013299334276099832182106610324947861504.000000, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 1087285867577130774827425174865999915939788842964675778514012182770707564259058617075885158758087192224560450338546805519241079735736747658581136625682007228256384448624938832078059514747006755595008952409080716196654974275043259996866172470060483790206924336660681326592.000000, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792, 0.005792
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 25.0
#*# max_x = 350.0
#*# min_y = 25.0
#*# max_y = 350.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 11.998
#*# pid_ki = 1.311
#*# pid_kd = 27.445
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 18.403
#*# pid_ki = 0.414
#*# pid_kd = 204.270
#*#

